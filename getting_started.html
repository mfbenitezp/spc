<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.4">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Synthetic Population Catalyst - Getting started</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>

  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="styles.css">
</head>
<body class="docked">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Getting started</h1>
      <button type="button" class="quarto-btn-toggle btn">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Synthetic Population Catalyst</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Synthetic Population Catalyst</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-using-it" aria-expanded="true">Using it</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-using-it" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-using-it" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started.html" class="sidebar-item-text sidebar-link active">Getting started</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./outputs.html" class="sidebar-item-text sidebar-link">Outputs</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./troubleshooting.html" class="sidebar-item-text sidebar-link">Troubleshooting</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-understanding-it" aria-expanded="true">Understanding it</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-understanding-it" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-understanding-it" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding.html" class="sidebar-item-text sidebar-link">The Data Schema</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelling_methods.html" class="sidebar-item-text sidebar-link">Modelling methods</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_sources.html" class="sidebar-item-text sidebar-link">Data sources</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-internals" aria-expanded="true">Internals</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-internals" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-internals" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./developer_guide.html" class="sidebar-item-text sidebar-link">Developer guide</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code_walkthrough.html" class="sidebar-item-text sidebar-link">Code walkthrough</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./performance.html" class="sidebar-item-text sidebar-link">Performance</a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#what-spc-does" class="nav-link active" data-scroll-target="#what-spc-does">What SPC does?</a></li>
<li><a href="#how-to-use-spc" class="nav-link" data-scroll-target="#how-to-use-spc">How to use SPC</a>
<ul class="collapse">
<li><a href="#installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
<li><a href="#create-a-new-study-area" class="nav-link" data-scroll-target="#create-a-new-study-area">Create a new study area</a></li>
<li><a href="#how-to-work-with-the-spc-output-files" class="nav-link" data-scroll-target="#how-to-work-with-the-spc-output-files">How to work with the SPC output files</a></li>
<li><a href="#converting-.pb-file-to-json-format" class="nav-link" data-scroll-target="#converting-.pb-file-to-json-format">Converting .pb file to JSON format</a></li>
<li><a href="#converting-to-numpy-arrays" class="nav-link" data-scroll-target="#converting-to-numpy-arrays">Converting to numpy arrays</a></li>
<li><a href="#visualizing-the-output-files." class="nav-link" data-scroll-target="#visualizing-the-output-files.">Visualizing the output files.</a></li>
</ul></li>
</ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Getting started</h1>
</header>

<section id="what-spc-does" class="level2">
<h2 class="anchored" data-anchor-id="what-spc-does">What SPC does?</h2>
<p>The SPC generates spatially enriched synthetic population outputs for multiple administrative and census boundaries including Local Authority Districts - LADs and Counties across England. The output file generated by SPC has a granularity of Middle Layer Super Output Areas - MSOAs. This file is estructured and convided to help other researchers or urban analysts to feed other dynamic models for multiples propouses where a enriched sythetic population file is requiered. SPC includes an comprenhenvise set of variables that include social-demogragfics characterictis, dayliy activities and other extra data sources to help you model the complexity of British society.</p>
<p>For information about the data sources and the varibles integrated in the SPC outfile, visit <a href="./data_sources.html">data sources</a>. For information about the administrative and census boundaries included in SPC visit the <a href="https://geoportal.statistics.gov.uk/">Open Geography portal</a> from the Office for National Statistics (ONS).</p>
</section>
<section id="how-to-use-spc" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use-spc">How to use SPC</h2>
<p>Using SPC we have already created the output file for all counties in England, so if the area you want to model is listed or you just want to explore the data, no need to run SPC yourself – just <a href="./outputs.html">download data for your area</a>.</p>
<p>If you are interested in create another area or combination of MSOAs, you will need then install and run SPC in your environment. We have tested SPC in Lunix and MacOS systems, for the moment there is no support for Windows system, but we are working hard to solver that issue.</p>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<section id="initial-requirements" class="level4">
<h4 class="anchored" data-anchor-id="initial-requirements">Initial Requirements</h4>
<ul>
<li><p><strong>Rust</strong>: The latest version of Rust (1.60): <a href="https://www.rust-lang.org/tools/install">https://www.rust-lang.org/tools/install</a></p></li>
<li><p>For Mac users, we recommend to have installed <strong>Homebrew</strong>: <a href="https://brew.sh/">https://brew.sh/</a></p></li>
<li><p><strong>Python</strong>, there are some scrips and functionalites inside SPC that requiere python. <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></p></li>
</ul>
</section>
<section id="one-time-installation" class="level4">
<h4 class="anchored" data-anchor-id="one-time-installation">One-time installation</h4>
<pre class="shell"><code>git clone https://github.com/alan-turing-institute/uatk-spc/
cd uatk-spc
# The next command will take a few minutes the first time you do it, to build external dependencies
cargo build --release</code></pre>
<p>If you get some errors during the compilation process, take a look at <a href="./troubleshooting.html">Troubleshooting</a> section.</p>
</section>
</section>
<section id="create-a-new-study-area" class="level3">
<h3 class="anchored" data-anchor-id="create-a-new-study-area">Create a new study area</h3>
<p>Once SPC is installed and you need to create a synthetic population for a new area not listed in one of our already genereted outputs, you need to do the following two steps:</p>
<p><strong>1. Adding a new study area text file in <code>/config</code> folder</strong>: SPC requieres a list of MSOAs for a given area. The MSOA code is not a conventional way to describe an area, so we have created a python script to assist you create the requiered input file for SPC.</p>
<p>Navigate to the folder <code>scripts</code> within SPC folder, and run <code>python select_msoas.py</code>, this script will ask you the name of the LAD or County you are interest in. Refer to <code>data/raw_data/referencedata/lookUp.csv</code> for all geographies that SPC support. A new file will be created in your config folder <code>config/your_region.txt</code> with the list of MSOAs.</p>
<p><strong>2. Run SPC for the new area list</strong>:</p>
<p>After you write a new file, you simply run the pipeline with that as input, make sure you are located in the <code>spc</code> folder</p>
<pre><code>cargo run --release -- config/your_region.txt</code></pre>
<p>If you like to take a quick look of how SPC process the data, you can use one of our small examples lists (west_yorkshire_small.txt, two_counties.txt)</p>
<pre><code>cargo run --release -- config/west_yorkshire_small.txt</code></pre>
<p>This will download some large files the first time. You’ll wind up with <code>data/output/west_yorkshire_small.pb</code> as output, as well as lots of intermediate files in <code>data/raw_data/</code>. The next time you run this command (even on a different study area), it should go much faster.</p>
</section>
<section id="how-to-work-with-the-spc-output-files" class="level3">
<h3 class="anchored" data-anchor-id="how-to-work-with-the-spc-output-files">How to work with the SPC output files</h3>
<p>Once you run SPC to generate a new study area based on your input file text, you will get in <code>/data/output</code> folder a <code>.pb</code> file. A .pb or <a href="https://developers.google.com/protocol-buffers/docs/overview">protocol buffer file</a> efficiently encode the the enriched synthetic population <a href="https://github.com/alan-turing-institute/uatk-spc/blob/main/synthpop.proto">schema</a>. You can read the “protobuf” (shorthand for a protocol buffer file) in any <a href="https://developers.google.com/protocol-buffers/docs/overview#cross-lang">supported language</a>, and then extract and transform just the parts of the data you want.</p>
<section id="python" class="level4">
<h4 class="anchored" data-anchor-id="python">Python</h4>
<p>To work with SPC protobufs in Python, you need two dependencies setup:</p>
<ul>
<li>The <a href="https://pypi.org/project/protobuf/">protobuf</a> library
<ul>
<li>You can install system-wide with <code>pip install protobuf</code></li>
<li>Or add as a dependency to a conda, poetry, etc environment</li>
</ul></li>
<li>The generated Python library, <a href="https://raw.githubusercontent.com/alan-turing-institute/uatk-spc/main/python/synthpop_pb2.py">synthpop_pb2.py</a>
<ul>
<li>You can download a copy of this file into your codebase, then <code>import synthpop_pb2</code></li>
<li>You can also generate the file yourself, following the <a href="https://developers.google.com/protocol-buffers/docs/reference/python-generated">docs</a>: <code>protoc --python_out=python/ synthpop.proto</code></li>
</ul></li>
</ul>
</section>
</section>
<section id="converting-.pb-file-to-json-format" class="level3">
<h3 class="anchored" data-anchor-id="converting-.pb-file-to-json-format">Converting .pb file to JSON format</h3>
<p>To interactively explore the data, viewing JSON is much easier. It shows the same structure as the protobuf, but in a human-readable text format. The example below uses a <a href="https://github.com/alan-turing-institute/uatk-spc/blob/main/python/protobuf_to_json.py">small Python script</a>:</p>
<pre class="shell"><code># Download a file
wget https://ramp0storage.blob.core.windows.net/spc-output/v1/rutland.pb.gz
# Uncompress
gunzip rutland.pb.gz
# Convert the .pb to JSON
python3 python/protobuf_to_json.py data/output/rutland.pb &gt; rutland.json
# View the output
less rutland.json</code></pre>
</section>
<section id="converting-to-numpy-arrays" class="level3">
<h3 class="anchored" data-anchor-id="converting-to-numpy-arrays">Converting to numpy arrays</h3>
<p>The <a href="https://github.com/alan-turing-institute/uatk-aspics">ASPICS</a> project simulates the spread of COVID through a population. The code uses numpy, and <a href="https://github.com/alan-turing-institute/uatk-aspics/blob/main/convert_snapshot.py">this script</a> converts the protobuf to a bunch of different numpy arrays.</p>
<p>Note the code doesn’t keep using classes from the generated Python code for protobufs. The protobuf is a format optimized for reading and writing; you shouldn’t use it in your model if there’s a more appropriate tool you’re familiar with, like data frames.</p>
</section>
<section id="visualizing-the-output-files." class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-output-files.">Visualizing the output files.</h3>
<p>Use <a href="https://github.com/alan-turing-institute/uatk-spc/blob/main/python/draw_venues.py">this script</a> to read a protobuf file, then draws a dot for every venue, color-coded by activity.</p>
<p><img src="img/venues.gif" class="img-fluid"></p>


</section>
</section>
</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->


</body></html>